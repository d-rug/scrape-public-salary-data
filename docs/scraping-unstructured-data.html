<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Scraping unstructured data | Scrape public [salary] data</title>
  <meta name="description" content="Scraping unstructured data | Scrape public [salary] data" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Scraping unstructured data | Scrape public [salary] data" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="d-rug/scrape-public-salary-data" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Scraping unstructured data | Scrape public [salary] data" />
  
  
  

<meta name="author" content="Liza Wood" />


<meta name="date" content="2022-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="scraping-structured-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://d-rug.github.io/">
  <img src="https://github.com/d-rug/d-rug.github.io/raw/main/DRUG_final_cobalt.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Scrape public [salary] data</a></li>

<li class="divider"></li>
<li><a href="index.html#overview" id="toc-overview">Overview<span></span></a></li>
<li><a href="scraping-unstructured-data.html#scraping-unstructured-data" id="toc-scraping-unstructured-data">Scraping unstructured data<span></span></a>
<ul>
<li><a href="scraping-unstructured-data.html#finding-your-data" id="toc-finding-your-data"><span class="toc-section-number">0.1</span> Finding your data<span></span></a></li>
<li><a href="scraping-unstructured-data.html#section" id="toc-section"><span class="toc-section-number">0.2</span> </a></li>
<li><a href="scraping-unstructured-data.html#formatting-unstructured-data" id="toc-formatting-unstructured-data"><span class="toc-section-number">0.3</span> Formatting unstructured data<span></span></a>
<ul>
<li><a href="scraping-unstructured-data.html#what-format-do-we-need-the-data-in" id="toc-what-format-do-we-need-the-data-in"><span class="toc-section-number">0.3.1</span> What format do we need the data in?<span></span></a></li>
<li><a href="scraping-unstructured-data.html#create-the-url" id="toc-create-the-url"><span class="toc-section-number">0.3.2</span> Create the URL<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="scraping-structured-data.html#scraping-structured-data" id="toc-scraping-structured-data"><span class="toc-section-number">1</span> Scraping structured data<span></span></a></li>
<li><a href="cleaning-with-regex.html#cleaning-with-regex" id="toc-cleaning-with-regex"><span class="toc-section-number">2</span> Cleaning with regex<span></span></a></li>
<li class="divider"></li>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
  <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" style="float: right; padding-right: 10px;" />
</a>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Scrape public [salary] data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scraping-unstructured-data" class="section level1 unnumbered hasAnchor">
<h1>Scraping unstructured data<a href="scraping-unstructured-data.html#scraping-unstructured-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="finding-your-data" class="section level2 hasAnchor" number="0.1">
<h2><span class="header-section-number">0.1</span> Finding your data<a href="scraping-unstructured-data.html#finding-your-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="section" class="section level2" number="0.2">
<h2><span class="header-section-number">0.2</span> </h2>
<p>We’ll use the following libraries:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="scraping-unstructured-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-2"><a href="scraping-unstructured-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb1-3"><a href="scraping-unstructured-data.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="scraping-unstructured-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://desp.ucdavis.edu/faculty&quot;</span></span>
<span id="cb5-2"><a href="scraping-unstructured-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span></code></pre></div>
<p>What do we want out of this mess? We want to find the ‘path’ that defines the location that this is written on the path. HTML, xpath</p>
<p>I use two main cheats.
1. For very specific paths, I will open up Developer Tools on a Browser, Ctrl+F what I am looking for in the webpage, right click on it, and copy the xpath.</p>
<p>[PHOTO]</p>
<p>The following paths are here, each on unique their name:
* Gwen Arnold: //<em><span class="citation">[@id="block-system-main"]</span>/div/div/div/div[1]/div[2]/h2/a
</em> Jesus Barajas: //<em><span class="citation">[@id="block-system-main"]</span>/div/div/div/div[2]/div[2]/h2/a
</em> Marissa Baskett: //*<span class="citation">[@id="block-system-main"]</span>/div/div/div/div[3]/div[2]/h2/a</p>
<p>BUT, then do help us see the thing in common: All of these names are in the //*<span class="citation">[@id="block-system-main"]</span> path, which gives us a sense of what the more generic path might be. We can confirm with the second tools..</p>
<ol start="2" style="list-style-type: decimal">
<li>The <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb?hl=en">Inspector Gadget ChromE extension</a> lets you select blocks of webpage’s and identify their Xpaths. When you use this selector, this allows you to see the more generic path to grab all of the names: //*<span class="citation">[(@id = "block-system-main")]</span>//a</li>
</ol>
<p>[PHOTO]</p>
<p>So, we can use this path to pull out the names – turning structured data into data. We can pull out the names the <code>xml_final_all()</code> function, and then piping that into the <code>html_text()</code> function, which read the text inside the XML nodeset.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="scraping-unstructured-data.html#cb6-1" aria-hidden="true" tabindex="-1"></a>faculty <span class="ot">&lt;-</span> <span class="fu">xml_find_all</span>(page, <span class="st">&#39;//*[(@id = &quot;block-system-main&quot;)]//a&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="scraping-unstructured-data.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span></code></pre></div>
<p>Now we have faculty names, but there is some blank text in there, so let’s clean this uo</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="scraping-unstructured-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>faculty <span class="ot">&lt;-</span> faculty <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="scraping-unstructured-data.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="scraping-unstructured-data.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb7-4"><a href="scraping-unstructured-data.html#cb7-4" aria-hidden="true" tabindex="-1"></a>faculty</span></code></pre></div>
<pre><code>##                      name
## 1             Gwen Arnold
## 2        Jesus M. Barajas
## 3      Marissa L. Baskett
## 4       Howard V. Cornell
## 5             Xiaoli Dong
## 6      Charles R. Goldman
## 7          Edwin Grosholz
## 8          Susan L. Handy
## 9       Susan P. Harrison
## 10          Alan Hastings
## 11      Robert J. Hijmans
## 12         Marcel Holyoak
## 13     Robert A. Johnston
## 14        John L. Largier
## 15         Mark N. Lubell
## 16             Alan Meier
## 17       Frances C. Moore
## 18       Steven G. Morgan
## 19          Joan M. Ogden
## 20             Ben Orlove
## 21         James F. Quinn
## 22      Eliska Rejmankova
## 23     Peter J. Richerson
## 24           Steven Sadro
## 25    James N. Sanchirico
## 26       Mark W. Schwartz
## 27         Sy I. Schwartz
## 28            Tyler Scott
## 29               Andy Sih
## 30        Daniel Sperling
## 31  Michael R. Springborn
## 32       Thomas P. Tomich
## 33 Fernanda S. Valdovinos</code></pre>
<p>So, we have the data, but often you need to clean up text data to make it a little more usable. Let’s look at the Transparent California wepage to understand how we want to feed these names into it.</p>
</div>
<div id="formatting-unstructured-data" class="section level2 hasAnchor" number="0.3">
<h2><span class="header-section-number">0.3</span> Formatting unstructured data<a href="scraping-unstructured-data.html#formatting-unstructured-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="what-format-do-we-need-the-data-in" class="section level3 hasAnchor" number="0.3.1">
<h3><span class="header-section-number">0.3.1</span> What format do we need the data in?<a href="scraping-unstructured-data.html#what-format-do-we-need-the-data-in" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you start of Transparent California, you’ll see a plain URL. One way of webscraping across multiple sites is to modify the URL for each page you want to scrape. If we dig into how URLs for pay in the UC system is stored, we find that it looks something like this:
<a href="https://transparentcalifornia.com/salaries/search/?a=university-of-california&amp;q=Mark+Lubell&amp;y=2021" class="uri">https://transparentcalifornia.com/salaries/search/?a=university-of-california&amp;q=Mark+Lubell&amp;y=2021</a></p>
<p>Let’s look at the pattenr that we want to manipulate:
<a href="https://transparentcalifornia.com/salaries/search/?a=university-of-california&amp;q=FIRSTNAME+LASTNAME&amp;y=2021" class="uri">https://transparentcalifornia.com/salaries/search/?a=university-of-california&amp;q=FIRSTNAME+LASTNAME&amp;y=2021</a></p>
</div>
<div id="create-the-url" class="section level3 hasAnchor" number="0.3.2">
<h3><span class="header-section-number">0.3.2</span> Create the URL<a href="scraping-unstructured-data.html#create-the-url" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s use some string manipulation tools to extract the first and last names, and paste together those names in within the URL pattern</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="scraping-unstructured-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<pre><code>## Warning: package &#39;stringr&#39; was built under R version 4.1.2</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="scraping-unstructured-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a>faculty <span class="ot">&lt;-</span> faculty <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="scraping-unstructured-data.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># takes first and last word</span></span>
<span id="cb11-3"><a href="scraping-unstructured-data.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_first =</span> <span class="fu">word</span>(name, <span class="dv">1</span>), </span>
<span id="cb11-4"><a href="scraping-unstructured-data.html#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">name_last =</span> <span class="fu">word</span>(name, <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="scraping-unstructured-data.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url_name =</span> <span class="fu">paste</span>(name_first, name_last, <span class="at">sep =</span> <span class="st">&quot;+&quot;</span>),</span>
<span id="cb11-6"><a href="scraping-unstructured-data.html#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">url =</span> <span class="fu">paste0</span>(<span class="st">&quot;https://transparentcalifornia.com/salaries/search/?a=university-of-california&amp;q=&quot;</span>, url_name, <span class="st">&quot;&amp;y=2021&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="scraping-structured-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/d-rug/scrape-public-salary-data/edit/master/01_scraping-unstructured-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/d-rug/scrape-public-salary-data/blob/master/01_scraping-unstructured-data.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
