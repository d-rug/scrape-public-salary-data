<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Scraping unstructured data | Scrape public [salary] data</title>
  <meta name="description" content="1 Scraping unstructured data | Scrape public [salary] data" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Scraping unstructured data | Scrape public [salary] data" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="d-rug/scrape-public-salary-data" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Scraping unstructured data | Scrape public [salary] data" />
  
  
  

<meta name="author" content="Liza Wood" />


<meta name="date" content="2022-11-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="formatting-unstructured-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.22/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://d-rug.github.io/">
  <img src="https://github.com/d-rug/d-rug.github.io/raw/main/DRUG_final_cobalt.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Scrape public [salary] data</a></li>

<li class="divider"></li>
<li><a href="index.html#overview" id="toc-overview">Overview<span></span></a></li>
<li><a href="scraping-unstructured-data.html#scraping-unstructured-data" id="toc-scraping-unstructured-data"><span class="toc-section-number">1</span> Scraping unstructured data<span></span></a>
<ul>
<li><a href="scraping-unstructured-data.html#reading-in-a-webpage" id="toc-reading-in-a-webpage"><span class="toc-section-number">1.1</span> Reading in a webpage<span></span></a></li>
<li><a href="scraping-unstructured-data.html#identifying-xpaths" id="toc-identifying-xpaths"><span class="toc-section-number">1.2</span> Identifying Xpaths<span></span></a></li>
</ul></li>
<li><a href="formatting-unstructured-data.html#formatting-unstructured-data" id="toc-formatting-unstructured-data"><span class="toc-section-number">2</span> Formatting unstructured data<span></span></a>
<ul>
<li><a href="formatting-unstructured-data.html#what-format-do-we-need-the-data-in" id="toc-what-format-do-we-need-the-data-in"><span class="toc-section-number">2.1</span> What format do we need the data in?<span></span></a></li>
</ul></li>
<li><a href="scraping-structured-data-iteravely.html#scraping-structured-data-iteravely" id="toc-scraping-structured-data-iteravely"><span class="toc-section-number">3</span> Scraping structured data iteravely<span></span></a>
<ul>
<li><a href="scraping-structured-data-iteravely.html#scrape-one-example" id="toc-scrape-one-example"><span class="toc-section-number">3.1</span> Scrape one example<span></span></a></li>
<li><a href="scraping-structured-data-iteravely.html#iterating-scrape-across-urls" id="toc-iterating-scrape-across-urls"><span class="toc-section-number">3.2</span> Iterating scrape across URLs<span></span></a></li>
</ul></li>
<li><a href="cleaning-with-regex.html#cleaning-with-regex" id="toc-cleaning-with-regex"><span class="toc-section-number">4</span> Cleaning with regex<span></span></a>
<ul>
<li><a href="cleaning-with-regex.html#filter-on-multiple-patterns" id="toc-filter-on-multiple-patterns"><span class="toc-section-number">4.1</span> Filter on multiple patterns<span></span></a></li>
<li><a href="cleaning-with-regex.html#remove-characters" id="toc-remove-characters"><span class="toc-section-number">4.2</span> Remove characters<span></span></a></li>
</ul></li>
<li class="divider"></li>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
  <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" style="float: right; padding-right: 10px;" />
</a>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Scrape public [salary] data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scraping-unstructured-data" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Scraping unstructured data<a href="scraping-unstructured-data.html#scraping-unstructured-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>To scrape salaries from the public salary database, we first need to gather the names of the employees we want to collect salary data on. So let’s go to a UC Davis website and find a departmental page with faculty names. I’ll use the <a href="https://desp.ucdavis.edu/faculty">Environmental Science and Policy Department</a> as an example.</p>
<p>We should also load in the following libraries that we’re going to use:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="scraping-unstructured-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-2"><a href="scraping-unstructured-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb1-3"><a href="scraping-unstructured-data.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<div id="reading-in-a-webpage" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Reading in a webpage<a href="scraping-unstructured-data.html#reading-in-a-webpage" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To read in the webpage, let’s assign the URL to an object, and use the <code>read_html()</code> function from <code>rvest()</code> to read the page.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="scraping-unstructured-data.html#cb2-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://desp.ucdavis.edu/faculty&quot;</span></span>
<span id="cb2-2"><a href="scraping-unstructured-data.html#cb2-2" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span></code></pre></div>
<p>But the page is currently stored as HTML, which is data we can readily work with in R.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="scraping-unstructured-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a>page</span></code></pre></div>
<pre><code>## {html_document}
## &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;
## [1] &lt;head profile=&quot;http://www.w3.org/1999/xhtml/vocab&quot;&gt;\n&lt;meta content=&quot;text/ ...
## [2] &lt;body class=&quot;html not-front not-logged-in one-sidebar sidebar-first page- ...</code></pre>
<p>So what do we want out of this? We want to find the ‘path’ that defines the location of the data we’re interested in extracting. But to know how to find that path we need to know a little bit about what’s in a web page. This is not my expert area, so I’ll point to a <a href="https://ucdavisdatalab.github.io/adventures_in_data_science/getting-data-from-the-web.html#web-scraping">UC Davis DataLab resource on web-scraping</a> that describes elements of webpages and more about HTML and XML.</p>
<p>For our purposes, it is important to know that <strong>HTML and XML – the language of webpages – use ‘tags’ to mark different parts of the webpage’s data</strong>. What we need to identify are the appropriate tags or paths to extract what we want. We can do this by identifying the ‘Xpaths’ – the path of tags that highlight particular parts of a page.</p>
</div>
<div id="identifying-xpaths" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Identifying Xpaths<a href="scraping-unstructured-data.html#identifying-xpaths" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I don’t use Xpaths everyday, and so I tend to use two methods to help me identify the page’s structure.</p>
<ol style="list-style-type: decimal">
<li>For very specific paths, I will open up Developer Tools on a Browser using <code>Cmd + Opt + I</code>, then inspecting the elements of the page, <code>Ctrl + F</code> to find the text of what I am looking for in the webpage. Once you find it you can right click &gt; Copy &gt; Xpath.</li>
</ol>
<p><img src="img/esp_xpath_copy.png" />)</p>
<p>When I use this process for the first three names on the faculty page I find the following paths, each on unique their name:</p>
<ul>
<li>Gwen Arnold: //*<span class="citation">[@id="block-system-main"]</span>/div/div/div/div[1]/div[2]/h2/a<br />
</li>
<li>Jesus Barajas: //*<span class="citation">[@id="block-system-main"]</span>/div/div/div/div[2]/div[2]/h2/a<br />
</li>
<li>Marissa Baskett: //*<span class="citation">[@id="block-system-main"]</span>/div/div/div/div[3]/div[2]/h2/a</li>
</ul>
<p>These are all too specific for trying to take all of the names with one path, but they do help us see the thing in common: All of these names are in the //*<span class="citation">[@id="block-system-main"]</span> path, which gives us a sense of what the more generic path might be. We can confirm with the second tool…</p>
<ol start="2" style="list-style-type: decimal">
<li>The <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb?hl=en">InspectorGadget Chrome extension</a> lets you click on blocks of a webpage and identify their Xpaths. When you use this gadget, you can see the more generic path to grab all of the names: //*<span class="citation">[(@id = "block-system-main")]</span>//a</li>
</ol>
<p><img src="img/esp_xpath_IG.png" /></p>
<p>So, we can use this path to pull out the names from the webpage – turning structured data into data. We pull out the names with the <code>xml_final_all()</code> function, and then pipe that into the <code>html_text()</code> function, which read the text inside the XML nodeset.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="scraping-unstructured-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a>faculty <span class="ot">&lt;-</span> <span class="fu">xml_find_all</span>(page, <span class="st">&#39;//*[(@id = &quot;block-system-main&quot;)]//a&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="scraping-unstructured-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span></code></pre></div>
<p>Now we have faculty names, but it is a bit messy, so we can start to clean it up next:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="scraping-unstructured-data.html#cb6-1" aria-hidden="true" tabindex="-1"></a>faculty</span></code></pre></div>
<pre><code>##  [1] &quot;&quot;                       &quot;Gwen Arnold&quot;            &quot;&quot;                      
##  [4] &quot;Jesus M. Barajas&quot;       &quot;&quot;                       &quot;Marissa L. Baskett&quot;    
##  [7] &quot;&quot;                       &quot;Howard V. Cornell&quot;      &quot;&quot;                      
## [10] &quot;Xiaoli Dong&quot;            &quot;&quot;                       &quot;Charles R. Goldman&quot;    
## [13] &quot;&quot;                       &quot;Edwin Grosholz&quot;         &quot;&quot;                      
## [16] &quot;Susan L. Handy&quot;         &quot;&quot;                       &quot;Susan P. Harrison&quot;     
## [19] &quot;&quot;                       &quot;Alan Hastings&quot;          &quot;&quot;                      
## [22] &quot;Robert J. Hijmans&quot;      &quot;&quot;                       &quot;Marcel Holyoak&quot;        
## [25] &quot;&quot;                       &quot;Robert A. Johnston&quot;     &quot;&quot;                      
## [28] &quot;John L. Largier&quot;        &quot;&quot;                       &quot;Mark N. Lubell&quot;        
## [31] &quot;&quot;                       &quot;Alan Meier&quot;             &quot;&quot;                      
## [34] &quot;Frances C. Moore&quot;       &quot;&quot;                       &quot;Steven G. Morgan&quot;      
## [37] &quot;&quot;                       &quot;Joan M. Ogden&quot;          &quot;&quot;                      
## [40] &quot;Ben Orlove&quot;             &quot;&quot;                       &quot;James F. Quinn&quot;        
## [43] &quot;&quot;                       &quot;Eliska Rejmankova&quot;      &quot;&quot;                      
## [46] &quot;Peter J. Richerson&quot;     &quot;&quot;                       &quot;Steven Sadro&quot;          
## [49] &quot;&quot;                       &quot;James N. Sanchirico&quot;    &quot;&quot;                      
## [52] &quot;Mark W. Schwartz&quot;       &quot;&quot;                       &quot;Sy I. Schwartz&quot;        
## [55] &quot;&quot;                       &quot;Tyler Scott&quot;            &quot;&quot;                      
## [58] &quot;Andy Sih&quot;               &quot;&quot;                       &quot;Daniel Sperling&quot;       
## [61] &quot;&quot;                       &quot;Michael R. Springborn&quot;  &quot;&quot;                      
## [64] &quot;Thomas P. Tomich&quot;       &quot;&quot;                       &quot;Fernanda S. Valdovinos&quot;</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="formatting-unstructured-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/d-rug/scrape-public-salary-data/edit/master/01_scraping-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/d-rug/scrape-public-salary-data/blob/master/01_scraping-data.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
